import{_ as s,o as a,c as n,V as l}from"./chunks/framework.48c56699.js";const A=JSON.parse('{"title":"介绍","description":"","frontmatter":{},"headers":[],"relativePath":"notes/springcloud/Docker.md","filePath":"notes/springcloud/Docker.md","lastUpdated":null}'),o={name:"notes/springcloud/Docker.md"},p=l(`<h1 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-label="Permalink to &quot;介绍&quot;">​</a></h1><h2 id="项目部署过程中遇到的问题" tabindex="-1">项目部署过程中遇到的问题 <a class="header-anchor" href="#项目部署过程中遇到的问题" aria-label="Permalink to &quot;项目部署过程中遇到的问题&quot;">​</a></h2><p>大型项目组件较多，运行环境复杂，部署时会遇到一些问题：</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614195529307.png" alt="image-20230614195529307"></p><ul><li>依赖关系复杂，每个组件可能需要不同的环境</li><li>即使不同组件依赖同一个环境，也可能因为library库不同而冲突</li><li>而且环境多，一般分为开发、测试、生产，各个环境中的依赖也是不同的</li><li>最常见的问题就是：在一个环境中是正常运行的，但是到了另一个环境中就库库报bug</li></ul><h3 id="docker解决依赖的兼容问题" tabindex="-1">Docker解决依赖的兼容问题 <a class="header-anchor" href="#docker解决依赖的兼容问题" aria-label="Permalink to &quot;Docker解决依赖的兼容问题&quot;">​</a></h3><p>将每个组件需要的依赖库等一起打包发布，并放在一个独立的容器中去运行</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614195929130.png" alt="image-20230614195929130"></p><h3 id="docker跨系统运行" tabindex="-1">Docker跨系统运行 <a class="header-anchor" href="#docker跨系统运行" aria-label="Permalink to &quot;Docker跨系统运行&quot;">​</a></h3><p>不同的操作系统，依赖库、底层实现也都是不同的，那么Docker是如何解决跨系统运行呢？</p><p>先来了解操作系统的结构，所有的Linux系统，都可以分为三层：</p><ul><li>系统应用</li><li>内核</li><li>计算机硬件</li></ul><p>比如，Ubuntu与Centos，都是Linux的发行版，他们只是系统应用不同，内核都是相同的，都是Linux内核。</p><ul><li>内核与硬件交互，提供操作硬件的指令</li><li>系统应用，例如CentOS、Ubuntu，在内核的基础上，封装内核指令为函数，便于程序员开发使用</li><li>用户程序，也就是我们开发的应用，运行在系统应用上，依赖于系统应用提供的库函数</li></ul><p><strong>因此，在Ubuntu上开发的用户程序，在CentOS上运行就会出现问题，因此系统应用不同，依赖的库函数也不同</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614200250977.png" alt="image-20230614200250977"></p><p>那么Docker是如何解决不同系统环境的呢？</p><p><strong>Docker将用户程序与所需要的系统函数库一起打包，</strong></p><p><strong>Docker运行到不同的操作系统时，直接基于打包的函数，借助于Linux内核来运行，因此只要是Linux的内核，就能运行</strong></p><h2 id="总结docker概念" tabindex="-1">总结Docker概念 <a class="header-anchor" href="#总结docker概念" aria-label="Permalink to &quot;总结Docker概念&quot;">​</a></h2><blockquote><p><a href="https://docs.docker.com/" target="_blank" rel="noreferrer">Docker — 官方文档</a></p></blockquote><p>Docker如何解决依赖关系复杂、不同组件兼容性的问题？</p><ul><li><strong>Docker允许开发中将应用、依赖、函数库、配置一起打包，形成可移植镜像</strong></li><li><strong>Docker应用运行在容器中，使用沙箱机制，相互隔离</strong></li></ul><p>Docker如何解决开发、测试、生产环境有差异的问题？</p><ul><li><strong>Docker镜像中包含完整运行环境，包括系统函数库，Docker应用仅依赖于Linux内核，因此可以运行在任意Linux内核操作系统之上</strong></li></ul><p>总结Docker的概念：<strong>Docker是一个快速交付应用、运行应用的技术</strong></p><ul><li><strong>可以将程序及其依赖、运行环境一起打包为一个镜像，可以迁移到任意Linux操作系统</strong></li><li><strong>运行时利用沙箱机制形成容器隔离，各个应用互不干扰</strong></li><li><strong>由于只需要Linux内核，所以启动、移除可以通过一行命令完成，方便便捷</strong></li></ul><p>Docker的Logo描述的十分形象：</p><ul><li>一个大鲸鱼的货轮</li><li>货轮上的一个集装箱就是一个容器，就是一个应用</li></ul><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614201756332.png" alt="image-20230614201756332"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614201816478.png" alt="image-20230614201816478"></p><h2 id="docker与虚拟机" tabindex="-1">Docker与虚拟机 <a class="header-anchor" href="#docker与虚拟机" aria-label="Permalink to &quot;Docker与虚拟机&quot;">​</a></h2><p><strong>虚拟机是在操作系统中，模拟硬件设备，然后运行另一个操作系统</strong></p><p><strong>由于虚拟机中的操作系统，经过了层层包装，因此调用起来，性能较差</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614202139784.png" alt="image-20230614202139784"></p><p><strong>而Docker是直接调用Linux内核，因此效率更高</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614202327097.png" alt="image-20230614202327097"></p><h2 id="docker架构" tabindex="-1">Docker架构 <a class="header-anchor" href="#docker架构" aria-label="Permalink to &quot;Docker架构&quot;">​</a></h2><h3 id="镜像和容器" tabindex="-1">镜像和容器 <a class="header-anchor" href="#镜像和容器" aria-label="Permalink to &quot;镜像和容器&quot;">​</a></h3><ul><li><strong>镜像（lmage): Docker将应用程序及其所需的依赖、函数库、环境、配置等文件打包在一起，这个打包后的文件，称为镜像。</strong></li><li><strong>容器（Container):镜像中的应用程序运行后形成的进程就是容器，只是Docker会给容器做隔离，对外不可见。</strong></li></ul><p>注意：镜像文件是只读的，启动后的容器不能向镜像文件中写数据。</p><p>容器如果有数据要存储，则可以从镜像文件中复制一份目录出来，作为自己容器的一部分，去执行数据操作。</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614202918599.png" alt="image-20230614202918599"></p><h3 id="dockerhub" tabindex="-1">DockerHub <a class="header-anchor" href="#dockerhub" aria-label="Permalink to &quot;DockerHub&quot;">​</a></h3><p><strong>DockerHub是一个Docker镜像托管平台（类似于GitHub），这样的平台称作Docker Registry</strong></p><p>国内类似于DockerHub的公开服务，例如阿里云镜像服务、网易云镜像服务等，或者也可以自己搭建私有云。</p><h3 id="c-s架构" tabindex="-1">C/S架构 <a class="header-anchor" href="#c-s架构" aria-label="Permalink to &quot;C/S架构&quot;">​</a></h3><p>Docker是一个CS架构的程序，由两部分组成：</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614203425670.png" alt="image-20230614203425670"></p><h1 id="docker的安装" tabindex="-1">Docker的安装 <a class="header-anchor" href="#docker的安装" aria-label="Permalink to &quot;Docker的安装&quot;">​</a></h1><p>Docker可以安装在任意操作系统上，但是目前企业主流都是基于Linux开发。</p><p>而在所有的Linux发型版中，Centos最常用。</p><p>Docker 分为 CE 和 EE 两大版本。CE 即社区版（免费，支持周期 7 个月），EE 即企业版，强调安全，付费使用，支持周期 24 个月。</p><p>Docker CE 分为 <code>stable</code> <code>test</code> 和 <code>nightly</code> 三个更新频道。</p><p>官方网站上有各种环境下的 <a href="https://docs.docker.com/install/" target="_blank" rel="noreferrer">安装指南</a>，这里主要介绍 Docker CE 在 CentOS上的安装。</p><h2 id="_1-centos安装docker" tabindex="-1">1.CentOS安装Docker <a class="header-anchor" href="#_1-centos安装docker" aria-label="Permalink to &quot;1.CentOS安装Docker&quot;">​</a></h2><p>Docker CE 支持 64 位版本 CentOS 7，并且要求内核版本不低于 3.10， CentOS 7 满足最低内核的要求，所以我们在CentOS 7安装Docker。</p><h2 id="_1-1-卸载-可选" tabindex="-1">1.1.卸载（可选） <a class="header-anchor" href="#_1-1-卸载-可选" aria-label="Permalink to &quot;1.1.卸载（可选）&quot;">​</a></h2><p>如果之前安装过旧版本的Docker，可以使用下面命令卸载：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">remove</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-client</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-client-latest</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-common</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-latest</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-latest-logrotate</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-logrotate</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-selinux</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-engine-selinux</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-engine</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                  </span><span style="color:#C3E88D;">docker-ce</span></span></code></pre></div><h2 id="_1-2-安装docker" tabindex="-1">1.2.安装docker <a class="header-anchor" href="#_1-2-安装docker" aria-label="Permalink to &quot;1.2.安装docker&quot;">​</a></h2><p>首先需要虚拟机联网，安装yum工具包，方便后续的下载使用</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum-utils</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">device-mapper-persistent-data</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">           </span><span style="color:#C3E88D;">lvm2</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--skip-broken</span></span></code></pre></div><p>然后更新本地镜像源：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 设置docker镜像源</span></span>
<span class="line"><span style="color:#FFCB6B;">yum-config-manager</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--add-repo</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#FFCB6B;">sed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s/download.docker.com/mirrors.aliyun.com\\/docker-ce/g</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/yum.repos.d/docker-ce.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">makecache</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">fast</span></span></code></pre></div><p>然后输入命令：</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce</span></span></code></pre></div><p>docker-ce为社区免费版本。稍等片刻，docker即可安装成功。</p><h2 id="_1-3-启动docker" tabindex="-1">1.3.启动docker <a class="header-anchor" href="#_1-3-启动docker" aria-label="Permalink to &quot;1.3.启动docker&quot;">​</a></h2><p>Docker应用需要用到各种端口，逐一去修改防火墙设置。非常麻烦，因此建议大家直接关闭防火墙！</p><p>启动docker前，一定要关闭防火墙后！！</p><p><strong>企业开发中，不可以随意关闭防火墙</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 关闭</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">firewalld</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 禁止开机启动防火墙</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">disable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">firewalld</span></span></code></pre></div><p>通过命令启动docker：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 启动docker服务</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 停止docker服务</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 重启docker服务</span></span></code></pre></div><p>然后输入命令，可以查看docker版本：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">docker -v</span></span></code></pre></div><p>启动Docker后，可以查看是否启动成功，利用命令</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230614210121355.png" alt="image-20230614210121355"></p><h2 id="_1-4-配置镜像加速" tabindex="-1">1.4.配置镜像加速 <a class="header-anchor" href="#_1-4-配置镜像加速" aria-label="Permalink to &quot;1.4.配置镜像加速&quot;">​</a></h2><p>docker官方镜像仓库网速较差，我们需要设置国内镜像服务：</p><p>参考阿里云的镜像加速文档：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noreferrer">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p><p>直接复制一下命令执行</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/docker</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/docker/daemon.json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;-</span><span style="color:#A6ACCD;">&#39;</span><span style="color:#89DDFF;">EOF</span><span style="color:#A6ACCD;">&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;registry-mirrors&quot;: [&quot;https://bi3lizub.mirror.aliyuncs.com&quot;]</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">daemon-reload</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span></code></pre></div><p><strong>以后，通过Docker拉取pull镜像，就会走阿里云的镜像，速度更快</strong></p><h1 id="docker的基本操作" tabindex="-1">Docker的基本操作 <a class="header-anchor" href="#docker的基本操作" aria-label="Permalink to &quot;Docker的基本操作&quot;">​</a></h1><h2 id="镜像相关命令" tabindex="-1">镜像相关命令 <a class="header-anchor" href="#镜像相关命令" aria-label="Permalink to &quot;镜像相关命令&quot;">​</a></h2><p>镜像名称一般分两部分组成：<code>[repository]:[tag]</code></p><p>例如<code>mysql:5.7</code>，如果在拉取镜像时，没有指定tag，那么默认就是<code>latest</code>，即最新版。</p><p>以下就是Docker中最常用的几个命令</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616141233889.png" alt="image-20230616141233889"></p><blockquote><p>关于Docker的命令，并不需要都熟悉。</p><p>查看Docker帮助文档，列出所有的命令</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span></span></code></pre></div><p>查看某个命令的帮助文档</p><p>例如，查看<code>docker images</code>这个命令的帮助文档</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span></span></code></pre></div></blockquote><h3 id="拉取镜像" tabindex="-1">拉取镜像 <a class="header-anchor" href="#拉取镜像" aria-label="Permalink to &quot;拉取镜像&quot;">​</a></h3><p>例如，我们要拉取一个Nginx的镜像</p><ol><li>去镜像仓库去搜索nginx镜像，比如<a href="https://hub.docker.com/" target="_blank" rel="noreferrer">dockerhub</a></li></ol><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616141830381.png" alt="image-20230616141830381"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616141912971.png" alt="image-20230616141912971"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616142628744.png" alt="image-20230616142628744"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616142649411.png" alt="image-20230616142649411"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616142335787.png" alt="image-20230616142335787"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616142414400.png" alt="image-20230616142414400"></p><p>然后去命令行执行，然后就会拉取pull镜像到本地</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616144626023.png" alt="image-20230616144626023"></p><p>查看已下载的镜像</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@localhost </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># docker images</span></span>
<span class="line"><span style="color:#FFCB6B;">REPOSITORY</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">TAG</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">IMAGE</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ID</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">CREATED</span><span style="color:#A6ACCD;">         </span><span style="color:#C3E88D;">SIZE</span></span>
<span class="line"><span style="color:#FFCB6B;">nginx</span><span style="color:#A6ACCD;">        </span><span style="color:#C3E88D;">latest</span><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">605</span><span style="color:#C3E88D;">c77e624dd</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">17</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">months</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ago</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">141</span><span style="color:#C3E88D;">MB</span></span></code></pre></div><h3 id="保存镜像文件为压缩包" tabindex="-1">保存镜像文件为压缩包 <a class="header-anchor" href="#保存镜像文件为压缩包" aria-label="Permalink to &quot;保存镜像文件为压缩包&quot;">​</a></h3><p>首先可以通过帮助文档来查看此命令的帮助文档</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@localhost </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># docker save --help</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Usage:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> [OPTIONS] IMAGE </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">IMAGE...</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">one</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">more</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">archive</span><span style="color:#A6ACCD;"> (streamed </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">STDOUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Aliases:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">image</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Options:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">-o,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--output</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">string</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">Write</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">file,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">instead</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">of</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">STDOUT</span></span></code></pre></div><p>执行此命令</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616145235149.png" alt="image-20230616145235149"></p><h3 id="删除镜像文件" tabindex="-1">删除镜像文件 <a class="header-anchor" href="#删除镜像文件" aria-label="Permalink to &quot;删除镜像文件&quot;">​</a></h3><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616145434465.png" alt="image-20230616145434465"></p><h3 id="加载镜像压缩包文件" tabindex="-1">加载镜像压缩包文件 <a class="header-anchor" href="#加载镜像压缩包文件" aria-label="Permalink to &quot;加载镜像压缩包文件&quot;">​</a></h3><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616145739919.png" alt="image-20230616145739919"></p><h2 id="容器相关命令" tabindex="-1">容器相关命令 <a class="header-anchor" href="#容器相关命令" aria-label="Permalink to &quot;容器相关命令&quot;">​</a></h2><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616150431449.png" alt="image-20230616150431449"></p><h3 id="创建并运行容器" tabindex="-1">创建并运行容器 <a class="header-anchor" href="#创建并运行容器" aria-label="Permalink to &quot;创建并运行容器&quot;">​</a></h3><ol><li>运行容器的第一步，建议去DockerHub上查看容器的运行命令</li></ol><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616150601503.png" alt="image-20230616150601503"></p><p>看这个命令，来解读一下</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myName</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span></code></pre></div><ul><li><code>docker run </code>启动容器</li><li><code>--name</code> 每个容器都要有唯一的名称</li><li><code>-p</code> 将宿主端口与容器端口做映射，冒号左侧是宿主机端口，右侧是容器端口</li><li><code>-d</code> 后台运行容器</li><li>最后的那个单词<code>nginx</code>就是镜像的名称 ，没有<code>tag</code>，默认就是latest</li></ul><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616151602081.png" alt="image-20230616151602081"></p><p><strong>返回值是容器的id，与名称一样，都是唯一的</strong></p><h3 id="查看容器的运行状态" tabindex="-1">查看容器的运行状态 <a class="header-anchor" href="#查看容器的运行状态" aria-label="Permalink to &quot;查看容器的运行状态&quot;">​</a></h3><p>此命令默认查看运行中的容器的状态</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616151704396.png" alt="image-20230616151704396"></p><p>如果想要看停止掉的容器，可以通过<code>-a</code>选项</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616154844663.png" alt="image-20230616154844663"></p><h3 id="查看容器的运行日志" tabindex="-1">查看容器的运行日志 <a class="header-anchor" href="#查看容器的运行日志" aria-label="Permalink to &quot;查看容器的运行日志&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">logs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">contanerName</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616151950620.png" alt="image-20230616151950620"></p><p><strong>如果不想每次查看容器运行日志，都执行一次命令，则可以使用选项<code>-f</code>，持续追踪日志</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616152327857.png" alt="image-20230616152327857"></p><h3 id="进入容器操作" tabindex="-1">进入容器操作 <a class="header-anchor" href="#进入容器操作" aria-label="Permalink to &quot;进入容器操作&quot;">​</a></h3><p>看这个命令</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerName</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span></code></pre></div><p>解读一波：</p><ul><li><code>docker exec</code>进入容器内部</li><li><code>-it</code> 给当前进入的容器创建一个标准输入、输出终端，允许我们与容器交互</li><li><code>containerName</code>指定容器名称</li><li><code>bash</code>进入容器后执行的命令，<code>bash</code>是一个Linux终端交互命令</li></ul><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616153633947.png" alt="image-20230616153633947"></p><p><strong>进入到容器内部后，会发现有基本的Linux的目录结构，但是在Linux中的部分命令是无法使用的</strong></p><p><strong>对于这个容器中的目录结构，以及各个文件，我们是不清楚的，所以还需要借助官方的文档</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616153854079.png" alt="image-20230616153854079"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616154058464.png" alt="image-20230616154058464"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616154228237.png" alt="image-20230616154228237"></p><p><strong>由于容器中不支持Linux中的部分命令，所以我们不能使用Vi编辑器对文件进行修改</strong></p><p><strong>对容器中的内容进行修改时，我们可以使用以下命令</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s#Welcome to nginx#我是刘明凯#g</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s#&lt;head&gt;#&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;#g</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">index.html</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616154438892.png" alt="image-20230616154438892"></p><blockquote><p><strong>可以通过<code>docker exec</code>命令来进入容器，操作容器内部</strong></p><p>但是这种行为是不推荐的，因为在容器中没有提供常用的命令。</p><p>因为容器是别人封装好的，所以非必须不修改容器中的文件。</p></blockquote><h3 id="停止容器" tabindex="-1">停止容器 <a class="header-anchor" href="#停止容器" aria-label="Permalink to &quot;停止容器&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerName</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616154726172.png" alt="image-20230616154726172"></p><p>查看停止掉的容器</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616154844663.png" alt=""></p><h3 id="启动容器" tabindex="-1">启动容器 <a class="header-anchor" href="#启动容器" aria-label="Permalink to &quot;启动容器&quot;">​</a></h3><p><code>docker run </code>命令是创建并启动容器。</p><p>当我们有了容器之后，就不需要此命令了，直接通过<code>docker start</code>来启动</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerName</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616155113291.png" alt="image-20230616155113291"></p><h3 id="删除容器" tabindex="-1">删除容器 <a class="header-anchor" href="#删除容器" aria-label="Permalink to &quot;删除容器&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerName</span></span></code></pre></div><p>默认情况下，不能删除运行中的容器。</p><p>如果要强制删除，则可以利用<code>-f</code>选项</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616155327814.png" alt="image-20230616155327814"></p><h2 id="数据卷" tabindex="-1">数据卷 <a class="header-anchor" href="#数据卷" aria-label="Permalink to &quot;数据卷&quot;">​</a></h2><p>容器与数据耦合的问题：</p><ul><li>不便于修改，每次修改容器中的文件，都需要先进入容器，而且容器内不能使用常规的编辑命令</li><li>数据不可复用，在容器内的修改对外是不可见的。所有修改对新创建的容器不可复用的。</li><li>升级维护困难，所有的数据都存在于容器内部，如果要升级容器，则需要先删除旧容器，所有的数据就会丢失</li></ul><h3 id="介绍-1" tabindex="-1">介绍 <a class="header-anchor" href="#介绍-1" aria-label="Permalink to &quot;介绍&quot;">​</a></h3><p>数据卷（Volume）是一个虚拟目录，指向宿主机文件系统中的某个目录。（类似于Windows中的软链接）</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616180312458.png" alt="image-20230616180312458"></p><p><strong>简单点说，我们利用Docker创建了一个数据卷Volume，这个Volume就是一个软链接，指向真正的宿主机中的<code>/var/lib/docker/volumes/</code>下的的真的的文件目录，因此，我们可以让容器来挂载这个volume，这样容器中的数据就会真正的同步到宿主真正的文件中，当删除容器后，数据还会存在。同时，还解决了修改容器文件的问题，我们只需要修改宿主机中的真正的文件即可，容器就会读取到该文件。还解决了数据隔离的问题，让多个容器挂载同一个volume，就能实现数据共享</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616185508547.png" alt="image-20230616185508547"></p><h3 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h3><p><strong>数据卷的操作命令是一个二级命令，基本语法如下：</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> [command]</span></span></code></pre></div><p>常用命令</p><ul><li><code>create</code> 创建一个volume</li><li><code>inspect</code> 显示一个或多个volume详细信息</li><li><code>ls</code> 列出所有的volume</li><li><code>prune</code> 删除未使用的volume</li><li><code>rm</code> 删除指定的一个或多个volume</li></ul><p>可以通过<code>docker volume –help</code>来查看这些命令</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@localhost </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"># docker volume --help</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Usage:</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">COMMAND</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Manage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volumes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Commands:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">create</span><span style="color:#A6ACCD;">      </span><span style="color:#C3E88D;">Create</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volume</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">inspect</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">Display</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">detailed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">information</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">one</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">more</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volumes</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">ls</span><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">List</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volumes</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">prune</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">Remove</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">unused</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volumes</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;">          </span><span style="color:#C3E88D;">Remove</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">one</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">or</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">more</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">volumes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Run</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">docker volume COMMAND --help</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">more</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">information</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">command.</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616191708779.png" alt="image-20230616191708779"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616191846620.png" alt="image-20230616191846620"></p><h3 id="容器挂载数据卷" tabindex="-1">容器挂载数据卷 <a class="header-anchor" href="#容器挂载数据卷" aria-label="Permalink to &quot;容器挂载数据卷&quot;">​</a></h3><p><strong>我们在创建容器时，可以通过<code>-v</code>选项来挂载一个数据卷到某个容器目录</strong></p><ul><li>冒号左侧是<strong>数据卷的名称</strong></li><li>右侧是容器内的需要被挂载的目录</li></ul><p><strong>在创建容器时，如果使用<code>-v</code>选项指定了一个不存在的数据卷volume，那么就会自动创建该数据卷并挂载</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616201200322.png" alt="image-20230616201200322"></p><p>然后，接下来，我们打开真实的数据卷的目录，发现容器中指定目录下的文件已经出现在真正的宿主路径中了。</p><p>就可以任性操作这些文件了。</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616201748654.png" alt="image-20230616201748654"></p><h4 id="直接挂载宿主机目录" tabindex="-1">直接挂载宿主机目录 <a class="header-anchor" href="#直接挂载宿主机目录" aria-label="Permalink to &quot;直接挂载宿主机目录&quot;">​</a></h4><p>目录挂载与数据卷挂载的语法是类似的。</p><ul><li><code>-v [宿主机目录]:[容器内目录]</code></li><li><code>-v [宿主机文件]:[容器内文件]</code></li></ul><p>例如：我现在要创建并运行一个MySQL容器，将宿主目录直接挂载到容器</p><p>去DockerHub查看MySQL的文档</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616210042454.png" alt="image-20230616210042454"></p><p>接下来开始操作</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616205206855.png" alt="image-20230616205206855"></p><p>创建目录，等会直接挂载到mysql容器</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616205401191.png" alt="image-20230616205401191"></p><p>在<code>mysql/conf</code>下新建一个mysql的配置文件</p><div class="language-conf"><button title="Copy Code" class="copy"></button><span class="lang">conf</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[mysqld]</span></span>
<span class="line"><span style="color:#A6ACCD;">skip-name-resolve</span></span>
<span class="line"><span style="color:#A6ACCD;">character_set_server=utf8</span></span>
<span class="line"><span style="color:#A6ACCD;">datadir=/var/lib/mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">server-id=1000</span></span></code></pre></div><p>创建Mysql容器，</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@localhost conf</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"># docker run \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> --name mysql \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -d \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -e MYSQL_ROOT_PASSWORD=123456 \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -p 3306:3306 \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -v /tmp/mysql/conf/my.cnf:/etc/mysql/conf.d/my.cnf \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -v /tmp/mysql/data/:/var/lib/mysql \\</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> mysql:latest</span></span></code></pre></div><h3 id="两种挂载方式对比" tabindex="-1">两种挂载方式对比 <a class="header-anchor" href="#两种挂载方式对比" aria-label="Permalink to &quot;两种挂载方式对比&quot;">​</a></h3><ul><li>创建数据卷并挂载 <ul><li>耦合度低，由Docker负责管理目录，真实的目录比较深</li></ul></li><li>直接挂载真实目录 <ul><li>耦合度高，我们自己定义的目录，方便管理</li></ul></li></ul><h1 id="dockerfile自定义镜像" tabindex="-1">Dockerfile自定义镜像 <a class="header-anchor" href="#dockerfile自定义镜像" aria-label="Permalink to &quot;Dockerfile自定义镜像&quot;">​</a></h1><p>如何基于DockerFile自定义镜像？</p><h2 id="镜像结构" tabindex="-1">镜像结构 <a class="header-anchor" href="#镜像结构" aria-label="Permalink to &quot;镜像结构&quot;">​</a></h2><p><strong>镜像就是将应用程序及其需要的系统函数库、环境、配置、依赖打包而成</strong></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616212313316.png" alt="image-20230616212313316"></p><p><strong>镜像的结构是分层的：每一层都是一个Layer</strong></p><ul><li><strong>BaseImage层：包含基本的系统函数库、环境变量、文件系统</strong></li><li><strong>EntryPoint：入口，是镜像中应用启动的命令</strong></li><li><strong>其他：在BaseImage基础上添加依赖、安装程序、完成整个应用的安装和配置</strong></li></ul><h2 id="dockerfile语法" tabindex="-1">DockerFile语法 <a class="header-anchor" href="#dockerfile语法" aria-label="Permalink to &quot;DockerFile语法&quot;">​</a></h2><p><strong>DockerFile是一个文本文件，其中包含了一个个的指令Instruction，用指令来说明要执行什么操作来构建镜像，每一个指令都会形成一层Layer</strong>。构建镜像时，就会按照DockerFile中的命令去构建镜像文件。</p><p><strong>Dockerfile文件描述了构建镜像的过程</strong></p><p>常见指令</p><table><thead><tr><th>指令</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td>FROM</td><td>指定基础镜像</td><td>FROM centos:7</td></tr><tr><td>ENV</td><td>设置环境变量，可在后面指令中使用</td><td>ENV key value</td></tr><tr><td>COPY</td><td>拷贝本地文件到镜像的指定目录</td><td>COPY ./mysql-5.7.rpm /tmp</td></tr><tr><td>RUN</td><td>执行linux的shell命令，一般是安装过程的命令</td><td>RUN yum install gcc</td></tr><tr><td>EXPOSE</td><td>指定容器运行时监听的端口，是给镜像的使用者看的</td><td>EXPOSE 8080</td></tr><tr><td>ENTRYPOINT</td><td>镜像中应用的启动命令，容器运行时调用</td><td>ENTRYPOINT java -jar xx-web.jar</td></tr></tbody></table><p>更多的语法：<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noreferrer">官网https://docs.docker.com/engine/reference/builder/</a></p><p>举个例子：</p><p>创建一个我们自己Java项目的镜像。</p><ol><li><p>我们新建一个目录作为演示目录<code>/tmp/docker-demo/</code></p></li><li><p>上传我们的项目打包后的jar文件，以及jdk环境</p></li><li><p>准备Dockerfile文件，文件名称叫做<code>Dockerfile</code></p></li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 指定基础镜像</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM ubuntu:16.04</span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置环境变量，JDK的安装目录</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV JAVA_DIR=/usr/local</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 拷贝jdk和java项目的包</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./jdk8.tar.gz $JAVA_DIR/</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./docker-demo.jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 安装JDK</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN cd $JAVA_DIR \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; tar -xf ./jdk8.tar.gz \\</span></span>
<span class="line"><span style="color:#A6ACCD;"> &amp;&amp; mv ./jdk1.8.0_144 ./java8</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 配置环境变量</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV JAVA_HOME=$JAVA_DIR/java8</span></span>
<span class="line"><span style="color:#A6ACCD;">ENV PATH=$PATH:$JAVA_HOME/bin</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 暴露端口</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 8090</span></span>
<span class="line"><span style="color:#A6ACCD;"># 入口，java项目的启动命令</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT java -jar /tmp/app.jar</span></span></code></pre></div><p>最终<code>docker-demo/</code>中有</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616214436513.png" alt="image-20230616214436513"></p><ol start="4"><li><strong>！！执行构建命令</strong></li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">javaweb:1.0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span></code></pre></div><p><strong>注意：</strong></p><ul><li><code>-t</code>的全称是<code>-tag</code>，用来指定的工件的标签</li><li>最后的<code>.</code>是用来指明Dockerfile所在的目录</li></ul><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616214648514.png" alt="image-20230616214648514"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616215009652.png" alt="image-20230616215009652"></p><h2 id="基于java-8-alpine构建java项目为镜像" tabindex="-1">基于java:8-alpine构建Java项目为镜像 <a class="header-anchor" href="#基于java-8-alpine构建java项目为镜像" aria-label="Permalink to &quot;基于java:8-alpine构建Java项目为镜像&quot;">​</a></h2><p>观察Dockerfile文件的内容</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616215301714.png" alt="image-20230616215301714"></p><p>我们的所有项目，在构建镜像时，唯一不同的就是打包后的jar文件不同，其余的操作都是在构建环境。</p><p>如果每次构建环境都需要写那些重复构建环境的指令，还需要提前准备好jdk的镜像文件，甚是繁琐。</p><p><strong>有这样一个镜像，名称叫做<code>java:8-alpine</code>，是一个体积非常小的jdk的镜像，这个镜像已经帮我们把构建环境的指令写好了，所以我们以此为基础，只需要写拷贝jar包的一个指令就好了</strong></p><p>我们修改后的Dockerfile文件，非常清爽</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 构建环境</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM java:8-alpine</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 拷贝项目</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./docker-demo.jar /tmp/app.jar</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 暴露端口</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 8090</span></span>
<span class="line"><span style="color:#A6ACCD;"># 入口，java项目的启动命令</span></span>
<span class="line"><span style="color:#A6ACCD;">ENTRYPOINT java -jar /tmp/app.jar</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230616220323752.png" alt="image-20230616220323752"></p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><ol><li><p>Dockerfile的本质是一个文件，通过指令描述镜像的构建过程</p></li><li><p><strong>Dockerfile的第一行必须是FROM，从一个基础镜像来构建</strong></p></li><li><p><strong>基础镜像可以是基本操作系统，如Ubuntu。也可以是其他人制作好的镜像，例如：java:8-alpine</strong></p></li></ol><h1 id="docker-compose" tabindex="-1">Docker-Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;Docker-Compose&quot;">​</a></h1><h2 id="介绍-2" tabindex="-1">介绍 <a class="header-anchor" href="#介绍-2" aria-label="Permalink to &quot;介绍&quot;">​</a></h2><p>Docker Compose可以基于Compose文件帮我们快速的部署<strong>分布式应用</strong>，而无需手动一个个创建和运行容器！</p><p>(LOGO是一个章鱼，手里拿着的是一个个的容器）</p><blockquote><p><a href="https://docs.docker.com/compose/compose-file/" target="_blank" rel="noreferrer">更多语法–官网https://docs.docker.com/compose/compose-file/</a></p></blockquote><p>DockerCompose帮助我们构建分布式服务的原理，比较简单，就是根据我们自定义的Compose文件，去构建，在这个文件中定义了各个服务的相关信息。</p><p>Compose文件的基本格式如下，类似于yaml文件，看下面这个文件内容：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.8</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mysql</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:5.7.25</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#F07178;">MYSQL_ROOT_PASSWORD</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/tmp/mysql/data:/var/lib/mysql</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/tmp/mysql/conf/hmy.cnf:/etc/mysql/conf.d/hmy.cnf</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">web</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8090:8090</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>在这个文件中，描述了两个容器，也就是两个服务：</p><ul><li>mysql，基于我们指定的镜像去构建容器，并且挂载了两个目录</li><li>web，基于<code>docker build</code>临时构建的镜像容器，映射的端口是8090</li></ul><h2 id="安装dockercompose" tabindex="-1">安装DockerCompose <a class="header-anchor" href="#安装dockercompose" aria-label="Permalink to &quot;安装DockerCompose&quot;">​</a></h2><p>​ 命令行通过命令下载：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 安装</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/docker/compose/releases/download/1.23.1/docker-compose-</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">uname</span><span style="color:#C3E88D;"> -s</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">-</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">uname</span><span style="color:#C3E88D;"> -m</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/usr/local/bin/docker-compose</span></span></code></pre></div><p>如果下载失败或很慢，可以使用文件上传的方式</p><p>修改我们刚才下载的文件</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 修改权限</span></span>
<span class="line"><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/local/bin/docker-compose</span></span></code></pre></div><p>开启Base命令自动补全：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 补全命令</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/docker/compose/1.29.1/contrib/completion/bash/docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/bash_completion.d/docker-compose</span></span></code></pre></div><p>如果此处下载失败，则可以修改hosts文件</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">199.232.68.133 raw.githubusercontent.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/hosts</span></span></code></pre></div><p>至此，基本的环境都准备好了。</p><h2 id="部署微服务集群" tabindex="-1">部署微服务集群 <a class="header-anchor" href="#部署微服务集群" aria-label="Permalink to &quot;部署微服务集群&quot;">​</a></h2><p>准备好我们的微服务项目：</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617101833802.png" alt="image-20230617101833802"></p><p>在每个服务目录中都有对应的jar包，以及Dockerfile文件，Compose在构建整体项目时，就会去执行每个服务的Dockerfile文件去构建单个的服务。</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617102012032.png" alt="image-20230617102012032"></p><p><strong>注意：我们的单个服务，在打成jar包前，要先修改一下配置文件，因为我们要基于Docker容器去部署每个服务，容器之间是相互隔离的，所以服务之间的调用就不能通过ip来实现了，而是通过容器名称来实现调用的。所以我们的服务的配置文件中，修改需要调用服务的容器名</strong>，像这样：</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">spring</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">datasource</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jdbc:mysql://mysql:3306/cloud_order?useSSL=false</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">driver-class-name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">application</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">orderservice</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">cloud</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">nacos</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">server-addr</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nacos:8848</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># nacos服务地址</span></span></code></pre></div><p>准备我们的Compose文件，<strong>注意文件名称叫做<code>docker-compose.yml</code></strong></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.2</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nacos</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nacos/nacos-server</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">MODE</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">standalone</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8848:8848</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mysql</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:5.7.25</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">MYSQL_ROOT_PASSWORD</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">123</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">$PWD/mysql/data:/var/lib/mysql</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">$PWD/mysql/conf:/etc/mysql/conf.d/</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">userservice</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./user-service</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">orderservice</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./order-service</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">gateway</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./gateway</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10010:10010</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>在这个文件中，我们部署了5个服务，：</p><ul><li><code>nacos</code>：作为注册中心和配置中心 <ul><li><code>image: nacos/nacos-server</code>： 基于nacos/nacos-server镜像构建</li><li><code>environment</code>：环境变量 <ul><li><code>MODE: standalone</code>：单点模式启动</li></ul></li><li><code>ports</code>：端口映射，这里暴露了8848端口</li></ul></li><li><code>mysql</code>：数据库 <ul><li><code>image: mysql:5.7.25</code>：镜像版本是mysql:5.7.25</li><li><code>environment</code>：环境变量 <ul><li><code>MYSQL_ROOT_PASSWORD: 123</code>：设置数据库root账户的密码为123</li></ul></li><li><code>volumes</code>：数据卷挂载，这里挂载了mysql的data、conf目录，其中有我提前准备好的数据</li></ul></li><li><code>userservice</code>、<code>orderservice</code>、<code>gateway</code>：都是基于Dockerfile临时构建的</li></ul><p><strong>将我们准备的微服务项目上传到Linux中，进入到微服务项目的根目录，也就是Compose文件所在的目录，执行构建命令</strong></p><p><strong>利用<code>docker-compose up</code>命令来部署微服务项目</strong></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span></code></pre></div><p>接下来，就会将每个服务单独启动为一个容器，</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617105213332.png" alt="image-20230617105213332"></p><p><strong>接下来正常访问我们的微服务就好了</strong></p><p>**常用命令：**都可以通过<code>docker-compose –help</code>来查看，说几个常用的</p><ul><li><code>docker-compose logs</code>查看所有服务的日志</li><li><code>docker-compose stop</code>停止微服务</li></ul><h1 id="搭建docker镜像仓库" tabindex="-1">搭建Docker镜像仓库 <a class="header-anchor" href="#搭建docker镜像仓库" aria-label="Permalink to &quot;搭建Docker镜像仓库&quot;">​</a></h1><p>Docker的镜像仓库，有些类似于Maven仓库，都存在公开仓库和私有仓库。</p><ul><li>公共仓库，例如DockerHub、阿里云、网易云等公开仓库，我们都可以使用</li><li>私有仓库，例如公司内的仓库，仅对公司内开放，比较 安全。</li></ul><p>我们搭建Docker镜像仓库，是基于Docker官方提供的一个镜像来实现的<code>DockerRegistry</code></p><p><a href="https://docs.docker.com/registry/" target="_blank" rel="noreferrer">官方文档https://docs.docker.com/registry/</a></p><p>搭建的仓库，有两种版本：</p><ul><li>简化版 <ul><li>基础的镜像的拉取、上传、管理等镜像管理功能都齐备，但是没有UI界面，在命令行状态下</li></ul></li><li>完整版 <ul><li>在简化版的基础上，有了UI页面，操作更简单</li></ul></li></ul><p><strong>先来说，怎么搭建镜像仓库，等会再说怎么push、pull</strong></p><h2 id="搭建简化版" tabindex="-1">搭建简化版 <a class="header-anchor" href="#搭建简化版" aria-label="Permalink to &quot;搭建简化版&quot;">​</a></h2><p>简化版的搭建非常简单，只需要执行以下命令，来构建一个仓库容器就好了</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--restart=always</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry</span><span style="color:#A6ACCD;">	\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#C3E88D;">:5000</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry-data:/var/lib/registry</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">registry</span></span></code></pre></div><p>在这个命令中，我们挂载了<code>/var/lib/registry</code>目录为仓库的数据目录，所有的上传的镜像文件就会保存在此目录。</p><p>这样一个简化版的镜像仓库就搭建完成了。</p><h2 id="搭建图形化界面版本" tabindex="-1">搭建图形化界面版本 <a class="header-anchor" href="#搭建图形化界面版本" aria-label="Permalink to &quot;搭建图形化界面版本&quot;">​</a></h2><p>这个带有图形化界面的仓库，并不是Docker官方推出的，而是有一个个人在官方的简化版的基础上，增加了图形化界面。</p><p>这个仓库分为两个服务：</p><ul><li>第一个就是简化版的仓库服务，</li><li>第二个就是图形界面的前端服务，</li></ul><p>因此我们可以通过<code>docker-compose</code>来部署这个微服务项目。</p><p><strong>新建一个Compse文件</strong>，<code>docker-compose.yml</code></p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">3.0</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">registry</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./registry-data:/var/lib/registry</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">ui</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">joxit/docker-registry-ui:static</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8080:80</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">environment</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">REGISTRY_TITLE=这是我的私有Docker镜像仓库</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">REGISTRY_URL=http://registry:5000</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">depends_on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">registry</span></span></code></pre></div><p>不着急，配置一下Docker的信任地址，否则上传、拉取不成功</p><p>因此我们的私服采用的是http协议，不是https,默认不被Docker信任，所以需要做一个配置：</p><ol><li>打开如下文件</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 打开要修改的文件</span></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/docker/daemon.json</span></span></code></pre></div><ol start="2"><li>将我们的使用的ip添加进去，我的虚拟机ip是<code>192.168.163.156</code></li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 添加内容：</span></span>
<span class="line"><span style="color:#FFCB6B;">&quot;insecure-registries&quot;</span><span style="color:#82AAFF;">:</span><span style="color:#A6ACCD;">[</span><span style="color:#FFCB6B;">&quot;http://192.168.163.156:8080&quot;</span><span style="color:#FFCB6B;">]</span></span></code></pre></div><ol start="3"><li>重新加载此文件</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 重加载</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">daemon-reload</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 重启docker</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span></code></pre></div><p>接下来，在<code>docker-compose.yml</code>文件所在的目录，执行命令启动我们的仓库</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span></code></pre></div><p>接下来，访问我们配置的仓库地址，目前还没有镜像文件</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617110906987.png" alt="image-20230617110906987"></p><h2 id="镜像操作" tabindex="-1">镜像操作 <a class="header-anchor" href="#镜像操作" aria-label="Permalink to &quot;镜像操作&quot;">​</a></h2><p>推送镜像文件到私有库，必须先tag，即镜像文件的版本。</p><ol><li>重命名镜像文件，<strong>前缀是我们私有仓库的地址，后面就是正常的<code>名称：tag</code></strong></li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tag</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.163.156:8080/myNginx:1.0</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617111824818.png" alt=""></p><ol start="2"><li>推送镜像</li></ol><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">push</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.163.156:8080/my-nginx:1.0</span></span></code></pre></div><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617112548755.png" alt="image-20230617112548755"></p><p>再次查看仓库</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617112639108.png" alt="image-20230617112639108"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617112649181.png" alt="image-20230617112649181"></p><ol start="3"><li>拉取镜像</li></ol><p>可以通过以下命令来拉取</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.163.156:8080/my-nginx:1.0</span></span></code></pre></div><p>也可以通过仓库，查看该镜像文件，直接复制命令，然后回到命令行执行</p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617113056767.png" alt="image-20230617113056767"></p><p><img src="https://kkbank.oss-cn-qingdao.aliyuncs.com/note-img/image-20230617113832501.png" alt="image-20230617113832501"></p>`,333),e=[p];function c(t,r,i,C,y,D){return a(),n("div",null,e)}const g=s(o,[["render",c]]);export{A as __pageData,g as default};
